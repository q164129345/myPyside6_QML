# 🚀 Serial03 快速上手指南

## 5 分钟快速测试

### 准备工作

你需要以下之一来测试：

1. **虚拟串口对**（推荐用于学习）
   - 安装 com0com 或 VSPD
   - 创建 COM1 ↔ COM2 虚拟串口对

2. **串口回环**
   - 将串口的 TX 和 RX 短接
   - 发送的数据会立即返回

3. **两台电脑**
   - 用串口线连接两台电脑
   - 分别运行程序

---

## 🎯 测试步骤

### 测试 1: 程序启动与串口扫描

```powershell
# 1. 进入目录
cd d:\Coding\myPyside6_QML\serial03_send_receive

# 2. 运行程序
python main.py
```

**期望结果：**
- ✅ 窗口正常打开
- ✅ 系统日志显示"扫描完成"
- ✅ 串口下拉框显示可用串口

---

### 测试 2: 连接串口

**步骤：**
1. 选择一个串口（如 COM1）
2. 选择波特率（默认 9600）
3. 点击 "🔌 连接" 按钮

**期望结果：**
- ✅ 状态指示灯变绿并闪烁
- ✅ 状态文本显示"已连接"
- ✅ 系统日志显示"成功打开 COM1"
- ✅ 发送区域变为可用状态

**Python 控制台输出：**
```
[SerialBackend] 开始扫描串口...
[SerialBackend] 发现COM口: COM1 - ...
[SerialBackend] 扫描完成，共找到 X 个COM口
[SerialBackend] 尝试打开串口: COM1, 波特率: 9600
[SerialBackend] 成功打开 COM1
[SerialBackend] 串口参数 - 波特率:9600, 数据位:8, 校验:无, 停止位:1
```

---

### 测试 3: 发送 ASCII 数据

**步骤：**
1. 确保选中 "ASCII" 单选按钮
2. 在输入框输入：`Hello World`
3. 点击 "📤 发送" 按钮（或按回车）

**期望结果：**
- ✅ 输入框自动清空
- ✅ "发送历史" 区域显示：
  ```
  [12:34:56.789] 📤 发送: Hello World
  ```
- ✅ 系统日志显示：发送成功

**Python 控制台输出：**
```
[SerialBackend] 发送数据: ASCII='Hello World' | HEX=[48 65 6C 6C 6F 20 57 6F 72 6C 64] | 字节数:11
```

**如果使用回环或虚拟串口对：**
- ✅ "接收历史" 区域同时显示：
  ```
  [12:34:56.790] 📥 接收: Hello World
  ```

---

### 测试 4: 发送 HEX 数据

**步骤：**
1. 选中 "HEX" 单选按钮
2. 在输入框输入：`48 65 6C 6C 6F`
3. 点击 "📤 发送"

**期望结果：**
- ✅ 发送历史显示：
  ```
  [12:35:01.123] 📤 发送: Hello
  ```
  （注意：`48 65 6C 6C 6F` 对应 ASCII 的 "Hello"）

**Python 控制台输出：**
```
[SerialBackend] 发送HEX: [48 65 6C 6C 6F] | ASCII='Hello' | 字节数:5
```

**回环测试时：**
- ✅ 接收历史显示：
  ```
  [12:35:01.124] 📥 接收: Hello
  ```

---

### 测试 5: 切换显示格式

**步骤：**
1. 切换 "显示设置" 中的开关到 "HEX"
2. 观察发送和接收历史的变化

**期望结果：**
- ✅ 已有的历史记录**不会改变**（这是设计行为）
- ✅ 新发送的数据以 HEX 格式显示
- ✅ 新接收的数据以 HEX 格式显示

**例如，发送 "Test" 在 HEX 模式下显示：**
```
[12:36:00.000] 📤 发送: 54 65 73 74
```

---

### 测试 6: 错误处理

#### 6.1 未连接时发送
**步骤：**
1. 点击 "🔓 断开" 按钮
2. 尝试在输入框输入并发送

**期望结果：**
- ✅ 发送按钮变为禁用状态（灰色）
- ✅ 无法点击发送

#### 6.2 发送无效 HEX 数据
**步骤：**
1. 重新连接串口
2. 选择 HEX 模式
3. 输入无效数据：`XY ZZ`
4. 点击发送

**期望结果：**
- ✅ 系统日志显示错误：
  ```
  ❌ 错误: 无效的HEX格式，只能包含0-9和A-F
  ```

**Python 控制台输出：**
```
[SerialBackend] 无效的HEX格式，只能包含0-9和A-F
```

#### 6.3 发送奇数长度 HEX
**步骤：**
1. HEX 模式下输入：`48 6`（注意最后只有一个字符）
2. 点击发送

**期望结果：**
- ✅ 系统日志显示错误：
  ```
  ❌ 错误: HEX字符串长度必须为偶数
  ```

---

## 📊 功能验证清单

完成以下检查项，确保程序功能正常：

### ✅ 基础功能（继承自 serial02）
- [ ] 自动扫描串口
- [ ] 显示串口列表
- [ ] 选择波特率
- [ ] 连接串口成功
- [ ] 状态指示灯变化
- [ ] 断开串口成功
- [ ] 系统日志记录正确

### ✅ 发送功能（serial03 新增）
- [ ] ASCII 文本发送
- [ ] HEX 数据发送
- [ ] 发送历史显示
- [ ] 时间戳正确
- [ ] 输入验证有效
- [ ] 回车快捷键可用

### ✅ 接收功能（serial03 新增）
- [ ] 自动接收数据
- [ ] 接收历史显示
- [ ] 时间戳正确
- [ ] 数据格式正确

### ✅ 格式切换（serial03 新增）
- [ ] ASCII/HEX 切换生效
- [ ] 显示格式正确
- [ ] 切换有日志记录

### ✅ 错误处理
- [ ] 未连接时禁用发送
- [ ] 无效 HEX 有错误提示
- [ ] 奇数长度 HEX 有提示
- [ ] 空数据不发送

---

## 🔧 常见问题排查

### 问题 1: 找不到串口
```
症状：串口下拉框显示"未找到串口"
原因：
  - 没有可用的串口设备
  - 虚拟串口未安装
  - 权限不足

解决：
  1. 检查设备管理器中是否有串口
  2. 安装虚拟串口软件（com0com）
  3. 以管理员身份运行
```

### 问题 2: 无法打开串口
```
症状：点击连接后显示"无法打开"
原因：
  - 串口被其他程序占用
  - 串口不存在或已拔出
  - 权限不足

解决：
  1. 关闭其他串口调试工具
  2. 重新插拔设备
  3. 检查设备管理器
```

### 问题 3: 发送了但没接收到
```
症状：发送历史有记录，接收历史无内容
原因：
  - 未使用回环或虚拟串口对
  - 对方设备未响应
  - 接线错误（TX/RX 接反）

解决：
  1. 确认测试环境（回环/虚拟串口）
  2. 检查物理连接
  3. 使用另一个串口工具验证
```

### 问题 4: 接收到乱码
```
症状：接收的数据显示为乱码或符号
原因：
  - 波特率不匹配
  - 数据位/停止位/校验位不一致
  - 编码问题

解决：
  1. 确认两端波特率一致
  2. 切换到 HEX 模式查看原始数据
  3. 检查对方设备配置
```

---

## 💡 实验建议

### 实验 1: ASCII 与 HEX 对应关系

发送以下 HEX 数据，观察 ASCII 显示：

| HEX 输入 | 期望 ASCII |
|---------|-----------|
| `48 65 6C 6C 6F` | Hello |
| `31 32 33 34 35` | 12345 |
| `41 42 43 44 45` | ABCDE |
| `0D 0A` | 换行符 |

### 实验 2: 特殊字符处理

尝试发送以下数据：

```
ASCII 模式：
- Hello\nWorld  （观察换行）
- 中文字符      （观察UTF-8编码）
- Tab键        （观察制表符）

HEX 模式：
- 00 01 02 03  （不可打印字符）
- FF FE FD     （高位字节）
```

### 实验 3: 数据流压力测试

```
1. 连续发送 100 次 "Test"
2. 观察接收历史是否全部记录
3. 检查是否有数据丢失
4. 观察系统性能
```

---

## 📚 学习路径

完成上述测试后，你应该：

✅ **掌握了：**
- 串口数据的发送流程
- ASCII 和 HEX 的转换关系
- readyRead 信号的工作机制
- QByteArray 的使用方法

🎯 **下一步：**
- 学习 serial04：更复杂的数据处理
- 实现简单的通信协议
- 添加数据校验功能

---

## 🎓 总结

通过 serial03，你已经掌握了：
1. ✅ 串口基础通信
2. ✅ 数据格式转换
3. ✅ 信号驱动的接收
4. ✅ 错误处理机制

**这是串口通信的核心基础！**

继续保持学习，下一个实例 serial04 将带你进入更高级的数据处理领域！🚀
